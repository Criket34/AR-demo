<a-entity
  id="myModel"
  gltf-model="url(doki-color.glb)"
  scale="3 3 3"
  position="0 0 0"
  rotation="45 180 0"
  rotate-on-swipe="sensitivity: 0.5">
</a-entity>

<script>
AFRAME.registerComponent('rotate-on-swipe', {
  schema: {
    sensitivity: { default: 0.5 }   // 回転の感度
  },
  init: function () {
    this.isDragging = false;
    this.lastX = 0;
    this.lastY = 0;

    const r = this.el.getAttribute('rotation') || {x:0,y:0,z:0};
    this.rot = { x: r.x, y: r.y, z: r.z };

    this._onTouchStart = this.onTouchStart.bind(this);
    this._onTouchMove  = this.onTouchMove.bind(this);
    this._onTouchEnd   = this.onTouchEnd.bind(this);
    this._onMouseDown  = this.onMouseDown.bind(this);
    this._onMouseMove  = this.onMouseMove.bind(this);
    this._onMouseUp    = this.onMouseUp.bind(this);

    document.addEventListener('touchstart', this._onTouchStart, {passive:false});
    document.addEventListener('touchmove',  this._onTouchMove,  {passive:false});
    document.addEventListener('touchend',   this._onTouchEnd);
    document.addEventListener('mousedown',  this._onMouseDown);
    document.addEventListener('mousemove',  this._onMouseMove);
    document.addEventListener('mouseup',    this._onMouseUp);
  },
  remove: function () {
    document.removeEventListener('touchstart', this._onTouchStart);
    document.removeEventListener('touchmove',  this._onTouchMove);
    document.removeEventListener('touchend',   this._onTouchEnd);
    document.removeEventListener('mousedown',  this._onMouseDown);
    document.removeEventListener('mousemove',  this._onMouseMove);
    document.removeEventListener('mouseup',    this._onMouseUp);
  },
  applyDelta: function (dx, dy) {
    // 横スワイプ → Y回転、縦スワイプ → X回転
    this.rot.y += dx * this.data.sensitivity;
    this.rot.x += -dy * this.data.sensitivity;

    // もし斜めスワイプのときに「Z回転」も追加したいならここで調整
    // 例: 斜め移動成分をZに割り当てる
    // this.rot.z += (dx * dy) * 0.001 * this.data.sensitivity;

    this.el.setAttribute('rotation', `${this.rot.x} ${this.rot.y} ${this.rot.z}`);
  },
  onTouchStart: function (e) {
    if (e.touches.length !== 1) return;
    this.isDragging = true;
    this.lastX = e.touches[0].clientX;
    this.lastY = e.touches[0].clientY;
    e.preventDefault();
  },
  onTouchMove: function (e) {
    if (!this.isDragging || e.touches.length !== 1) return;
    const x = e.touches[0].clientX;
    const y = e.touches[0].clientY;
    const dx = x - this.lastX;
    const dy = y - this.lastY;
    this.lastX = x;
    this.lastY = y;
    this.applyDelta(dx, dy);
    e.preventDefault();
  },
  onTouchEnd: function () {
    this.isDragging = false;
  },
  onMouseDown: function (e) {
    this.isDragging = true;
    this.lastX = e.clientX;
    this.lastY = e.clientY;
  },
  onMouseMove: function (e) {
    if (!this.isDragging) return;
    const dx = e.clientX - this.lastX;
    const dy = e.clientY - this.lastY;
    this.lastX = e.clientX;
    this.lastY = e.clientY;
    this.applyDelta(dx, dy);
  },
  onMouseUp: function () {
    this.isDragging = false;
  }
});
</script>
